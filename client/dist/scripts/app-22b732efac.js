function RootController(t,a,e,i){var n=this;t.Globalize.culture(i.get("TRANSLATE_LANG_KEY")),n.changeLang=function(i){e.use(i),t.Globalize.culture(i),a.reload()},n.advertiser={name:"Adam"}}RootController.$inject=["$window","$state","$translate","$translateLocalStorage"],function(){"use strict";angular.module("pjtLayout",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngMessages","ngAria","ui.router","ui.bootstrap","toastr","dx","pascalprecht.translate","chart.js","ngStorage"])}(),angular.module("pjtLayout").controller("RootController",RootController),function(){"use strict";function t(t,a){function e(e,i,n){return t({method:"GET",url:"/api/v1/statistics",params:{from_date:e,to:i,by:n}}).then(function(t){for(var e in t.data.statistics){var i=a.get("TRANSLATE_LANG_KEY");t.data.statistics[e].cpc=parseFloat(t.data.statistics[e].cpc).toFixed(4),t.data.statistics[e].cpm=parseFloat(t.data.statistics[e].cpm).toFixed(4),t.data.statistics[e].spend=parseFloat(t.data.statistics[e].spend).toFixed(4),t.data.statistics[e].day=moment(t.data.statistics[e].day).locale(i).format("L")}return t.data})}function i(a,e){return t({method:"GET",url:"/api/v1/totals",params:{from_date:a,to:e}}).then(function(t){return t.data.totals.cpc=parseFloat(t.data.totals.cpc).toFixed(4),t.data.totals.cpm=parseFloat(t.data.totals.cpm).toFixed(4),t.data.totals.spend=parseFloat(t.data.totals.spend).toFixed(4),t.data.totals})}function n(a,e,i,n,o,s,l,r){return o?(s=o[0].desc===!0?"desc":"asc",o=o[0].selector):(o="campaign",s="DESC"),null==n&&(n=20),null==i&&(i=0),t({method:"GET",url:"/api/v1/campaigns",params:{from_date:a,to:e,skip:i,take:n,sort:o,order:s,stat_by:l,filter:r}}).then(function(t){for(var a in t.data.campaigns)t.data.campaigns[a].cpc=parseFloat(t.data.campaigns[a].cpc).toFixed(4),t.data.campaigns[a].cpm=parseFloat(t.data.campaigns[a].cpm).toFixed(4),t.data.campaigns[a].spend=parseFloat(t.data.campaigns[a].spend).toFixed(4);return t.data})}function o(a,e){return t({method:"GET",url:"http://private-anon-d71dffb7f-rtbs.apiary-mock.com/api/v1/map/clicks",params:{from_date:a,to:e}}).then(function(t){return t.data})}var s=this;s.statsCampaigns=n,s.statsTotals=i,s.statsChart=e,s.statsMap=o}t.$inject=["$http","$translateLocalStorage"],angular.module("pjtLayout").service("Main",t)}(),function(){"use strict";function t(t,a,e,i,n,o,s){var l=this;l.Main=s,l.multipleTotalCount=0,l.checkChart=[],l.by="";var r=n.instant;null==i.series&&(i.series=[{valueField:"imp",name:"Impressions"},{valueField:"cvr",name:"CVR"},{valueField:"cpc",name:"CPC"},{valueField:"clicks",name:"clicks"},{valueField:"spend",name:"media"},{valueField:"conv",name:"conversions"},{valueField:"ctr",name:"CTR"}]);var c=[];if(null==i.checkChart){i.checkChart={imp:!0,cvr:!0,cpc:!0,clicks:!0,spend:!0,conv:!0,ctr:!0},c=[];for(var d in i.checkChart)1==i.checkChart[d]&&c.push(d);l.by=c.join()}else{c=[];for(var d in i.checkChart)1==i.checkChart[d]&&c.push(d);l.by=c.join()}null==i.dataStart&&null==i.dataEnd?(i.dataStart=a.moment({hour:"00"}).subtract(1,"day").unix(),i.dataEnd=a.moment({hour:"00"}).subtract(1,"day").endOf("day").unix()):(l.dataStart=i.dataStart,l.dataEnd=i.dataEnd),null==i.SelectedTime&&(i.SelectedTime=0);var u=[{ID:0,Name:r("MAIN.DATE_PICKER.YESTERDAY"),dataStart:a.moment({hour:"00"}).subtract(1,"day").unix(),dataEnd:a.moment({hour:"00"}).subtract(1,"day").endOf("day").unix()},{ID:1,Name:r("MAIN.DATE_PICKER.LAST_3_DAYS"),dataStart:a.moment({hour:"00"}).subtract(3,"day").unix(),dataEnd:a.moment({hour:"00"}).unix()},{ID:2,Name:r("MAIN.DATE_PICKER.LAST_7_DAYS"),dataStart:a.moment({hour:"00"}).subtract(7,"day").unix(),dataEnd:a.moment({hour:"00"}).unix()},{ID:3,Name:r("MAIN.DATE_PICKER.LAST_14_DAYS"),dataStart:a.moment({hour:"00"}).subtract(14,"day").unix(),dataEnd:a.moment({hour:"00"}).unix()},{ID:4,Name:r("MAIN.DATE_PICKER.LAST_21_DAYS"),dataStart:a.moment({hour:"00"}).subtract(21,"day").unix(),dataEnd:a.moment({hour:"00"}).unix()},{ID:5,Name:r("MAIN.DATE_PICKER.CURRENT_MONTH"),dataStart:a.moment().startOf("month").unix(),dataEnd:a.moment().unix()},{ID:6,Name:r("MAIN.DATE_PICKER.LAST_MONTH"),dataStart:a.moment().subtract(1,"month").startOf("month").unix(),dataEnd:a.moment().subtract(1,"month").endOf("month").unix()},{ID:7,Name:r("MAIN.DATE_PICKER.LAST_90_DAYS"),dataStart:a.moment({hour:"00"}).subtract(90,"day").unix(),dataEnd:a.moment().unix()},{ID:8,Name:r("MAIN.DATE_PICKER.ALL_TIME"),dataStart:0,dataEnd:a.moment().unix()}];l.datePiker={items:u,displayExpr:"Name",valueExpr:"ID",value:u[i.SelectedTime].ID,onValueChanged:function(t){i.SelectedTime=t.value,i.dataStart=u[t.value].dataStart,i.dataEnd=u[t.value].dataEnd,e.reload()}},l.totals=[],l.chartStore=new a.DevExpress.data.CustomStore({totalCount:function(){return 0},load:function(){return l.Main.statsChart(l.dataStart,l.dataEnd,l.by).then(function(t){return t.statistics})}}),l.multipleStore=new a.DevExpress.data.CustomStore({totalCount:function(){return l.multipleTotalCount},load:function(t){return l.Main.statsCampaigns(l.dataStart,l.dataEnd,t.skip,t.take,t.sort,t.order,l.by,t.filter).then(function(t){return l.multipleTotalCount=t.totalCount,t.campaigns})}}),l.Main.statsTotals(l.dataStart,l.dataEnd).then(function(t){l.totals.spent=t.spend,l.totals.conv=t.conv,l.totals.imp=t.imp,l.totals.cpc=t.cpc,l.totals.cpm=t.cpm,l.totals.cvr=t.cvr,l.totals.ctr=t.ctr}),l.selectedItems=[],l.chartOptionsFuncgrid=[],l.dataGridOptionsMultiple={bindingOptions:{dataSource:"main.multipleStore"},onInitialized:function(t){l.dataGridOptionsMultipleFunc=t.component,l.dataGridOptionsMultipleFunc._controllers.columns._commandColumns[1].visibleIndex=15},showBorders:!0,alignment:"left",headerFilter:{visible:!0},allowColumnReordering:!0,allowColumnResizing:!0,columnAutoWidth:!0,columnChooser:{enabled:!0},columnFixing:{enabled:!0},pager:{showPageSizeSelector:!0,allowedPageSizes:[10,30,50],visible:!0,showNavigationButtons:!0},howBorders:!0,showRowLines:!0,columns:[{caption:r("MAIN.CAMPAIGN.COLUMNS.CAMPAIGN"),dataField:"campaign",fixed:!0,cellTemplate:function(t,e){t.addClass("a-campaign"),a.angular.element('<a href="#/campaign/'+e.data.id+'">'+e.data.campaign+"</a>").appendTo(t)}},{caption:r("MAIN.CAMPAIGN.COLUMNS.SPENT"),dataField:"spend"},{caption:r("MAIN.CAMPAIGN.COLUMNS.CONV"),dataField:"conv"},{caption:r("MAIN.CAMPAIGN.COLUMNS.IMP"),dataField:"imp"},{caption:r("MAIN.CAMPAIGN.COLUMNS.CLICKS"),dataField:"clicks"},{caption:r("MAIN.CAMPAIGN.COLUMNS.CPC"),dataField:"cpc"},{caption:r("MAIN.CAMPAIGN.COLUMNS.CPM"),dataField:"cpm"},{caption:r("MAIN.CAMPAIGN.COLUMNS.CVR"),dataField:"cvr"},{caption:r("MAIN.CAMPAIGN.COLUMNS.CTR"),dataField:"ctr"},{width:200,dataField:r("MAIN.CAMPAIGN.COLUMNS.STATS"),cellTemplate:function(t,e){if(e.data.chart){var n={onInitialized:function(t){l.chartOptionsFuncgrid[e.rowIndex]=t.component},dataSource:e.data.chart,size:{height:80},commonSeriesSettings:{argumentField:"day",type:"line",point:{size:2,hoverStyle:{border:{visible:!0,width:1},size:4}}},commonAxisSettings:{label:{visible:!1},grid:{visible:!1}},argumentAxis:{valueMarginsEnabled:!1,discreteAxisDivisionMode:"crossLabels",grid:{visible:!1},label:{visible:!1},minorGrid:{visible:!1},minorTick:{visible:!1},tick:{visible:!1}},series:i.series,legend:{visible:!1},tooltip:{enabled:!0,customizeTooltip:function(t){return{text:t.valueText}}}};t.addClass("img-container"),a.angular.element('<div id="chartMulti'+e.rowIndex+'" ></div>').appendTo(t),a.$("#chartMulti"+e.rowIndex).dxChart(n).dxChart("instance")}else t.addClass("img-container"),a.angular.element('<div id="chartMulti" ></div>').appendTo(t)}}],selection:{mode:"multiple"},onSelectionChanged:function(t){l.selectedItems=t.selectedRowsData,l.disabled=!l.selectedItems.length}},l.types=["line","stackedLine","fullStackedLine"],l.chartOptions={onInitialized:function(t){l.chartOptionsFunc=t.component},series:i.series,size:{width:500,height:230},bindingOptions:{dataSource:"main.chartStore"},commonSeriesSettings:{argumentField:"day",type:l.types[0],point:{size:3,hoverStyle:{border:{visible:!0,width:2},size:5}}},margin:{bottom:20},argumentAxis:{valueMarginsEnabled:!1,discreteAxisDivisionMode:"crossLabels",grid:{visible:!0}},legend:{verticalAlignment:"bottom",horizontalAlignment:"center",itemTextPosition:"bottom"},tooltip:{enabled:!0,customizeTooltip:function(t){return{text:t.valueText}}}},l.impressions={text:r("MAIN.CHECKBOX.IMPRESSIONS"),value:i.checkChart.imp?!0:!1,onValueChanged:function(t){if(1==t.value)i.checkChart.imp=!0,i.series.push({valueField:"imp",name:"Impressions"}),e.reload();else{i.checkChart.imp=!1;for(var a in i.series)"imp"==i.series[a].valueField&&i.series.splice(a,1);e.reload()}}},l.CPA={text:r("MAIN.CHECKBOX.CPA"),value:i.checkChart.cvr?!0:!1,onValueChanged:function(t){if(1==t.value)i.checkChart.cvr=!0,i.series.push({valueField:"cvr",name:"CVR"}),e.reload();else{i.checkChart.cvr=!1;for(var a in i.series)"cvr"==i.series[a].valueField&&i.series.splice(a,1);e.reload()}}},l.CPC={text:r("MAIN.CHECKBOX.CPC"),value:i.checkChart.cpc?!0:!1,onValueChanged:function(t){if(1==t.value)i.checkChart.cpc=!0,i.series.push({valueField:"cpc",name:"CPC"}),e.reload();else{i.checkChart.cpc=!1;for(var a in i.series)"cpc"==i.series[a].valueField&&i.series.splice(a,1);e.reload()}}},l.clicks={text:r("MAIN.CHECKBOX.CLICKS"),value:i.checkChart.clicks?!0:!1,onValueChanged:function(t){if(1==t.value)i.checkChart.clicks=!0,i.series.push({valueField:"clicks",name:"clicks"}),e.reload();else{i.checkChart.clicks=!1;for(var a in i.series)"clicks"==i.series[a].valueField&&i.series.splice(a,1);e.reload()}}},l.media={text:r("MAIN.CHECKBOX.MEDIA_SPENT"),value:i.checkChart.spend?!0:!1,onValueChanged:function(t){if(1==t.value)i.checkChart.spend=!0,i.series.push({valueField:"spend",name:"media"}),e.reload();else{i.checkChart.spend=!1;for(var a in i.series)"spend"==i.series[a].valueField&&i.series.splice(a,1);e.reload()}}},l.conversions={text:r("MAIN.CHECKBOX.CONVERSIONS"),value:i.checkChart.conv?!0:!1,onValueChanged:function(t){if(1==t.value)i.checkChart.conv=!0,i.series.push({valueField:"conv",name:"conversions"}),e.reload();else{i.checkChart.conv=!1;for(var a in i.series)"conv"==i.series[a].valueField&&i.series.splice(a,1);e.reload()}}},l.CTR={text:r("MAIN.CHECKBOX.CTR"),value:i.checkChart.ctr?!0:!1,onValueChanged:function(t){if(1==t.value)i.checkChart.ctr=!0,i.series.push({valueField:"ctr",name:"CTR"}),e.reload();else{i.checkChart.ctr=!1;for(var a in i.series)"ctr"==i.series[a].valueField&&i.series.splice(a,1);e.reload()}}};var m={};l.Main.statsMap(l.dataStart,l.dataEnd).then(function(t){m=t,$("#visualMap").dxVectorMap(l.vectorMapOptions)}),l.vectorMapOptions={size:{width:500,height:350},layers:[{name:"areas",dataSource:a.DevExpress.viz.map.sources.world,palette:"blue",colorGroups:[0,100,1e3,1e4],colorGroupingField:"clicks",label:{enabled:!0,dataField:"name"},customize:function(t){t.forEach(function(t){var a=t.attribute("name"),e=m[a];e&&t.attribute("clicks",e)})}}],tooltip:{enabled:!0,customizeTooltip:function(t){return{text:t.attribute("text")}}},legends:[{source:{layer:"areas",grouping:"color"},horizontalAlignment:"left",verticalAlignment:"bottom",customizeText:function(t){return t.start+" to "+t.end+" clicks"}}],bounds:[-180,85,180,-75]}}t.$inject=["$compile","$window","$state","$localStorage","$translate","$log","Main"],angular.module("pjtLayout").controller("MainController",t)}(),function(){"use strict";angular.module("pjtLayout").constant("RussianTranslations",{INDEX:{ADVERTISER_TITLE:"Статистика для",LEFT_NAV:{HOME:"Главная",CAMPAIGN:"Кампания",BILLING:"Биллинг",OPTIMIZER:"Оптимизатор"}},MAIN:{HOME:"Главная",DATE_PICKER:{YESTERDAY:"Вчера",LAST_3_DAYS:"Последние 3 дня",LAST_7_DAYS:"Последние 7 дней",LAST_14_DAYS:"Последние 14 дней",LAST_21_DAYS:"Последние 21 дней",CURRENT_MONTH:"Текущий месяц",LAST_MONTH:"Прошлый месяц",LAST_90_DAYS:"Последние 90 дней",ALL_TIME:"Все время"},TOTALS:{COLUMNS:{TOTALS:"ИТОГИ",SPENT:"Потрачено",CONV:"Конв",IMP:"Показы",CLICKS:"Клики",CPC:"CPC",CPM:"CPM",CVR:"CVR",CTR:"CTR"}},CAMPAIGN:{COLUMNS:{CAMPAIGN:"Кампания",SPENT:"Потрачено",CONV:"Конв",IMP:"Показы",CLICKS:"Клики",CPC:"CPC",CPM:"CPM",CVR:"CVR",CTR:"CTR",STATS:"Стат"}},CHECKBOX:{IMPRESSIONS:"Показы",CPA:"CPA",CPC:"CPC",CLICKS:"Клики",MEDIA_SPENT:"Потр на медий рекл",CONVERSIONS:"Конверсии",CTR:"CTR"}}})}(),function(){"use strict";angular.module("pjtLayout").constant("EnglishTranslations",{INDEX:{ADVERTISER_TITLE:"Stats for",LEFT_NAV:{HOME:"Home",CAMPAIGN:"Campaign",BILLING:"Billing",OPTIMIZER:"Optimizer"}},MAIN:{HOME:"Home",DATE_PICKER:{YESTERDAY:"Yesterday",LAST_3_DAYS:"Last 3 days",LAST_7_DAYS:"Last 7 days",LAST_14_DAYS:"Last 14 days",LAST_21_DAYS:"Last 21 days",CURRENT_MONTH:"Current month",LAST_MONTH:"Last month",LAST_90_DAYS:"Last 90 days",ALL_TIME:"All times"},TOTALS:{COLUMNS:{TOTALS:"TOTALS",SPENT:"Spent",CONV:"Conv",IMP:"Imp",CLICKS:"Clicks",CPC:"CPC",CPM:"CPM",CVR:"CVR",CTR:"CTR"}},CAMPAIGN:{COLUMNS:{CAMPAIGN:"Campaign",SPENT:"Spent",CONV:"Conv",IMP:"Imp",CLICKS:"Clicks",CPC:"CPC",CPM:"CPM",CVR:"CVR",CTR:"CTR",STATS:"Stats"}},CHECKBOX:{IMPRESSIONS:"Impressions",CPA:"CPA",CPC:"CPC",CLICKS:"Clicks",MEDIA_SPENT:"Media Spent",CONVERSIONS:"Conversions",CTR:"CTR"}}})}(),function(){"use strict";function t(t){}t.$inject=["$stateParams"],angular.module("pjtLayout").controller("CampaignController",t)}(),function(){"use strict";function t(t){t.debug("runBlock end")}t.$inject=["$log"],angular.module("pjtLayout").run(t)}(),function(){"use strict";function t(t,a){t.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainController",controllerAs:"main"}).state("campaign",{url:"/campaign/:id",templateUrl:"app/campaign/camp.html",controller:"CampaignController",controllerAs:"camp"}),a.otherwise("/")}t.$inject=["$stateProvider","$urlRouterProvider"],angular.module("pjtLayout").config(t)}(),function(){"use strict";angular.module("pjtLayout")}(),function(){"use strict";function t(t,a,e,i,n){t.debugEnabled(!0),e.translations("en",n),e.translations("ru",i),e.useSanitizeValueStrategy("escape"),e.preferredLanguage("ru"),e.useLocalStorage(),e.storageKey("TRANSLATE_LANG_KEY"),a.allowHtml=!0,a.timeOut=3e3,a.positionClass="toast-top-right",a.preventDuplicates=!0,a.progressBar=!0}t.$inject=["$logProvider","toastrConfig","$translateProvider","RussianTranslations","EnglishTranslations"],angular.module("pjtLayout").config(t)}(),angular.module("pjtLayout").run(["$templateCache",function(t){t.put("app/campaign/camp.html",'<div class="container-camp col-md-10 col-lg-offset-2 col-md-10 col-lg-offset-2"><h1 translate=USERS.TITLE>Home</h1><div class=row><div id=container><div dx-vector-map=camp.vectorMapOptions id=visualMap></div></div></div></div>'),t.put("app/main/main.html",'<div class="container-home col-md-10 col-lg-offset-2 col-md-10 col-lg-offset-2"><h1 translate=MAIN.HOME>Home</h1><div class="col-md-3 col-md-offset-8 piker"><div dx-select-box=main.datePiker></div></div><div class=row><div id=container><div class="col-md-6 contLeft"><div dx-chart=main.chartOptions id=chart></div><div class=col-md-12><div class=checkbox-container><label class=label-checkbox><div dx-check-box=main.impressions></div></label><label class=label-checkbox><div dx-check-box=main.CPA></div></label><label class=label-checkbox><div dx-check-box=main.CPC></div></label><label class=label-checkbox><div dx-check-box=main.clicks></div></label></div><div class=checkbox-container><label class=label-checkbox><div dx-check-box=main.media></div></label><label class=label-checkbox><div dx-check-box=main.conversions></div></label><label class=label-checkbox><div dx-check-box=main.CTR></div></label></div></div></div><div id=visualMap></div></div></div><div class="row first-grid table-responsive"><table class="table table-bordered"><tr><td translate=MAIN.TOTALS.COLUMNS.TOTALS></td><td translate=MAIN.TOTALS.COLUMNS.SPENT></td><td translate=MAIN.TOTALS.COLUMNS.CONV></td><td translate=MAIN.TOTALS.COLUMNS.IMP></td><td translate=MAIN.TOTALS.COLUMNS.CPC></td><td translate=MAIN.TOTALS.COLUMNS.CPM></td><td translate=MAIN.TOTALS.COLUMNS.CVR></td><td translate=MAIN.TOTALS.COLUMNS.CTR></td></tr><tr><td></td><td>{{main.totals.spent}}</td><td>{{main.totals.conv}}</td><td>{{main.totals.imp}}</td><td>{{main.totals.cpc}}</td><td>{{main.totals.cpm}}</td><td>{{main.totals.cvr}}</td><td>{{main.totals.ctr}}</td></tr></table></div><div class="row second-grid"><div id=gridContainer2 dx-data-grid=main.dataGridOptionsMultiple></div></div></div>')}]);